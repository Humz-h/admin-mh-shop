<div class="inventory-management">
  <!-- Back to Dashboard Button -->
  <div class="back-navigation">
    <button class="btn btn-secondary" (click)="goBack()">
      ‚Üê Quay l·∫°i Dashboard
    </button>
  </div>

  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-left">
        <button class="back-btn" (click)="goBack()">
          <span class="back-icon">‚Üê</span>
          Quay l·∫°i
        </button>
        <div class="title-section">
          <h1 class="page-title">Qu·∫£n l√Ω t·ªìn kho</h1>
          <p class="page-subtitle">Theo d√µi v√† qu·∫£n l√Ω t·ªìn kho s·∫£n ph·∫©m</p>
        </div>
      </div>
      <div class="header-right">
        <button class="refresh-btn" (click)="refreshData()" title="L√†m m·ªõi d·ªØ li·ªáu">
          <span class="refresh-icon">üîÑ</span>
          L√†m m·ªõi
        </button>
      </div>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-container" *ngIf="!isLoading && !error">
    <div class="stat-card">
      <div class="stat-icon">üì¶</div>
      <div class="stat-content">
        <h3>{{ getInventoryStats().total }}</h3>
        <p>T·ªïng s·∫£n ph·∫©m</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <h3>{{ getInventoryStats().inStock }}</h3>
        <p>C√≤n h√†ng</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚ö†Ô∏è</div>
      <div class="stat-content">
        <h3>{{ getInventoryStats().lowStock }}</h3>
        <p>S·∫Øp h·∫øt</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚ùå</div>
      <div class="stat-content">
        <h3>{{ getInventoryStats().outOfStock }}</h3>
        <p>H·∫øt h√†ng</p>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üí∞</div>
      <div class="stat-content">
        <h3>{{ formatCurrency(getInventoryStats().totalValue) }}</h3>
        <p>T·ªïng gi√° tr·ªã</p>
      </div>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="search-container">
      <div class="search-box">
        <input 
          type="text" 
          placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..." 
          [(ngModel)]="searchTerm"
          (input)="onSearchInput()"
          class="search-input">
        <span class="search-icon">üîç</span>
      </div>
    </div>
    <div class="filter-controls">
      <div class="filter-group">
        <label for="category">Danh m·ª•c:</label>
        <select [(ngModel)]="selectedCategory" (change)="filterItems()" class="filter-select" id="category">
          <option value="">T·∫•t c·∫£ danh m·ª•c</option>
          <option value="electronics">ƒêi·ªán t·ª≠</option>
          <option value="clothing">Th·ªùi trang</option>
          <option value="books">S√°ch</option>
          <option value="home">Gia d·ª•ng</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="status">Tr·∫°ng th√°i:</label>
        <select [(ngModel)]="selectedStatus" (change)="filterItems()" class="filter-select" id="status">
          <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
          <option value="in-stock">C√≤n h√†ng</option>
          <option value="low-stock">S·∫Øp h·∫øt</option>
          <option value="out-of-stock">H·∫øt h√†ng</option>
          <option value="overstock">T·ªìn kho cao</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="sort">S·∫Øp x·∫øp:</label>
        <select [(ngModel)]="sortBy" (change)="sortItems()" class="filter-select" id="sort">
          <option value="productName">S·∫Øp x·∫øp theo t√™n</option>
          <option value="currentStock">S·∫Øp x·∫øp theo t·ªìn kho</option>
          <option value="totalValue">S·∫Øp x·∫øp theo gi√° tr·ªã</option>
          <option value="lastUpdated">S·∫Øp x·∫øp theo ng√†y c·∫≠p nh·∫≠t</option>
        </select>
      </div>
      <button class="clear-btn" (click)="clearFilters()">
        <span class="clear-icon">üóëÔ∏è</span>
        X√≥a b·ªô l·ªçc
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading && !showSkeleton">
    <div class="loading-spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu t·ªìn kho...</p>
  </div>

  <!-- Skeleton Loading -->
  <div class="skeleton-container" *ngIf="showSkeleton">
    <div class="skeleton-table">
      <div class="skeleton-header">
        <div class="skeleton-cell" *ngFor="let i of [1,2,3,4,5,6,7,8,9]"></div>
      </div>
      <div class="skeleton-row" *ngFor="let i of [1,2,3,4,5,6,7,8,9,10]">
        <div class="skeleton-cell skeleton-image"></div>
        <div class="skeleton-cell skeleton-text"></div>
        <div class="skeleton-cell skeleton-badge"></div>
        <div class="skeleton-cell skeleton-number"></div>
        <div class="skeleton-cell skeleton-number"></div>
        <div class="skeleton-cell skeleton-number"></div>
        <div class="skeleton-cell skeleton-badge"></div>
        <div class="skeleton-cell skeleton-date"></div>
        <div class="skeleton-cell skeleton-actions"></div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error && !isLoading">
    <div class="error-message">
      <span class="error-icon">‚ö†Ô∏è</span>
      <p>{{ error }}</p>
      <button class="btn btn-primary" (click)="loadInventoryData()">Th·ª≠ l·∫°i</button>
    </div>
  </div>

  <!-- Inventory Table -->
  <div class="table-container" *ngIf="!isLoading && !error && !showSkeleton">
    <table class="inventory-table">
      <thead>
        <tr>
          <th>H√¨nh ·∫£nh</th>
          <th>T√™n s·∫£n ph·∫©m</th>
          <th>Danh m·ª•c</th>
          <th>T·ªìn kho hi·ªán t·∫°i</th>
          <th>T·ªìn kho t·ªëi thi·ªÉu</th>
          <th>T·ªìn kho t·ªëi ƒëa</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Gi√° tr·ªã t·ªïng</th>
          <th>C·∫≠p nh·∫≠t cu·ªëi</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of getPaginatedItems(); trackBy: trackByItemId">
          <td class="product-image">
            <img 
              [src]="getProductImage(item)" 
              [alt]="item.productName" 
              class="product-thumbnail"
              loading="lazy"
              (error)="onImageError($event)">
          </td>
          <td class="product-name">
            <div class="name-cell">
              <span class="name">{{ item.productName }}</span>
              <span class="sku">{{ item.sku }}</span>
            </div>
          </td>
          <td class="product-category">
            <span class="category-badge" [class]="'category-' + item.category">
              {{ getCategoryName(item.category) }}
            </span>
          </td>
          <td class="stock-current">
            <span class="stock-number" [class]="getStatusClass(item.status)">
              {{ item.currentStock }}
            </span>
          </td>
          <td class="stock-min">
            <span class="stock-number">{{ item.minStock }}</span>
          </td>
          <td class="stock-max">
            <span class="stock-number">{{ item.maxStock }}</span>
          </td>
          <td class="stock-status">
            <span class="status-badge" [class]="getStatusClass(item.status)">
              {{ getStatusText(item.status) }}
            </span>
          </td>
          <td class="total-value">
            <span class="value">{{ formatCurrency(item.totalValue) }}</span>
          </td>
          <td class="last-updated">
            {{ item.lastUpdated | date:'dd/MM/yyyy HH:mm' }}
          </td>
          <td class="actions">
            <div class="action-buttons">
              <button class="btn-action btn-update" (click)="openUpdateModal(item)" title="C·∫≠p nh·∫≠t t·ªìn kho">
                üìù
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="totalPages > 1">
    <div class="pagination">
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === 1"
        (click)="goToPage(currentPage - 1)">
        ‚Äπ
      </button>
      
      <button 
        *ngFor="let page of getPageNumbers()" 
        class="pagination-btn"
        [class.active]="page === currentPage"
        (click)="goToPage(page)">
        {{ page }}
      </button>
      
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === totalPages"
        (click)="goToPage(currentPage + 1)">
        ‚Ä∫
      </button>
    </div>
    
    <div class="pagination-info">
      Hi·ªÉn th·ªã {{ (currentPage - 1) * itemsPerPage + 1 }} - 
      {{ Math.min(currentPage * itemsPerPage, filteredItems.length) }} 
      trong {{ filteredItems.length }} s·∫£n ph·∫©m
    </div>
  </div>

  <!-- Update Stock Modal -->
  <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>C·∫≠p nh·∫≠t t·ªìn kho</h2>
        <button class="modal-close" (click)="closeModal()">√ó</button>
      </div>
      
      <div class="modal-body" *ngIf="selectedItem">
        <div class="product-info">
          <img [src]="getProductImage(selectedItem)" [alt]="selectedItem.productName" class="product-image">
          <div class="product-details">
            <h3>{{ selectedItem.productName }}</h3>
            <p class="sku">{{ selectedItem.sku }}</p>
            <p class="current-stock">T·ªìn kho hi·ªán t·∫°i: <strong>{{ selectedItem.currentStock }}</strong></p>
          </div>
        </div>
        
        <div class="form-group">
          <label for="newStock">S·ªë l∆∞·ª£ng t·ªìn kho m·ªõi *</label>
          <input 
            type="number" 
            id="newStock"
            [(ngModel)]="newStock" 
            name="newStock"
            min="0"
            required
            class="form-input">
        </div>
        
        <div class="form-group">
          <label for="updateReason">L√Ω do c·∫≠p nh·∫≠t *</label>
          <textarea 
            id="updateReason"
            [(ngModel)]="updateReason" 
            name="updateReason"
            rows="3"
            placeholder="Nh·∫≠p l√Ω do c·∫≠p nh·∫≠t t·ªìn kho..."
            required
            class="form-textarea"></textarea>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">
            H·ªßy
          </button>
          <button type="button" class="btn btn-primary" (click)="updateStock()">
            C·∫≠p nh·∫≠t
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

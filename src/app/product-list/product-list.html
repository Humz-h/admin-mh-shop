<div class="product-management">
  <!-- Back to Dashboard Button -->
  <div class="back-navigation">
    <button class="btn btn-secondary" (click)="goBack()">
      ‚Üê Quay l·∫°i Dashboard
    </button>
  </div>

  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Qu·∫£n l√Ω s·∫£n ph·∫©m</h1>
      <p class="page-subtitle">Qu·∫£n l√Ω danh s√°ch s·∫£n ph·∫©m trong h·ªá th·ªëng</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="refreshProducts()" title="L√†m m·ªõi d·ªØ li·ªáu">
        <span class="btn-icon">üîÑ</span>
        L√†m m·ªõi
      </button>
      <button class="btn btn-primary" (click)="openAddProductModal()">
        <span class="btn-icon">+</span>
        Th√™m s·∫£n ph·∫©m
      </button>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="search-box">
      <input 
        type="text" 
        placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..." 
        [(ngModel)]="searchTerm"
        (input)="onSearchInput()"
        class="search-input">
      <span class="search-icon">üîç</span>
    </div>
    <div class="filter-controls">
      <select [(ngModel)]="selectedCategory" (change)="filterProducts()" class="filter-select">
        <option value="">T·∫•t c·∫£ danh m·ª•c</option>
        <option value="electronics">ƒêi·ªán t·ª≠</option>
        <option value="clothing">Th·ªùi trang</option>
        <option value="books">S√°ch</option>
        <option value="home">Gia d·ª•ng</option>
      </select>
      <select [(ngModel)]="sortBy" (change)="sortProducts()" class="filter-select">
        <option value="name">S·∫Øp x·∫øp theo t√™n</option>
        <option value="price">S·∫Øp x·∫øp theo gi√°</option>
        <option value="stock">S·∫Øp x·∫øp theo t·ªìn kho</option>
        <option value="date">S·∫Øp x·∫øp theo ng√†y t·∫°o</option>
      </select>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading && !showSkeleton">
    <div class="loading-spinner"></div>
    <p>ƒêang t·∫£i danh s√°ch s·∫£n ph·∫©m...</p>
  </div>

  <!-- Skeleton Loading -->
  <div class="skeleton-container" *ngIf="showSkeleton">
    <div class="skeleton-table">
      <div class="skeleton-header">
        <div class="skeleton-cell" *ngFor="let i of [1,2,3,4,5,6,7,8]"></div>
      </div>
      <div class="skeleton-row" *ngFor="let i of [1,2,3,4,5,6,7,8,9,10]">
        <div class="skeleton-cell skeleton-image"></div>
        <div class="skeleton-cell skeleton-text"></div>
        <div class="skeleton-cell skeleton-badge"></div>
        <div class="skeleton-cell skeleton-price"></div>
        <div class="skeleton-cell skeleton-stock"></div>
        <div class="skeleton-cell skeleton-badge"></div>
        <div class="skeleton-cell skeleton-date"></div>
        <div class="skeleton-cell skeleton-actions"></div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error && !isLoading">
    <div class="error-message">
      <span class="error-icon">‚ö†Ô∏è</span>
      <p>{{ error }}</p>
      <button class="btn btn-primary" (click)="loadProducts()">Th·ª≠ l·∫°i</button>
    </div>
  </div>

  <!-- Products Table -->
  <div class="table-container" *ngIf="!isLoading && !error && !showSkeleton">
    <table class="products-table">
      <thead>
        <tr>
          <th>H√¨nh ·∫£nh</th>
          <th>T√™n s·∫£n ph·∫©m</th>
          <th>Danh m·ª•c</th>
          <th>Gi√°</th>
          <th>T·ªìn kho</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Ng√†y t·∫°o</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of filteredProducts; trackBy: trackByProductId">
          <td class="product-image">
            <img 
              [src]="getProductImage(product)" 
              [alt]="product.name" 
              class="product-thumbnail"
              loading="lazy"
              (error)="onImageError($event)">
          </td>
          <td class="product-name">
            <div class="name-cell">
              <span class="name">{{ product.name }}</span>
              <span class="sku">SKU: {{ product.sku }}</span>
            </div>
          </td>
          <td class="product-category">
            <span class="category-badge" [class]="'category-' + product.category">
              {{ getCategoryName(product.category) }}
            </span>
          </td>
          <td class="product-price">
            <span class="price">{{ formatCurrency(product.price) }}</span>
          </td>
          <td class="product-stock">
            <span class="stock" [class]="product.stock < 10 ? 'low-stock' : 'normal-stock'">
              {{ product.stock }}
            </span>
          </td>
          <td class="product-status">
            <span class="status-badge" [class]="product.status">
              {{ getStatusText(product.status) }}
            </span>
          </td>
          <td class="product-date">
            {{ product.createdAt | date:'dd/MM/yyyy' }}
          </td>
          <td class="product-actions">
            <div class="action-buttons">
              <button class="btn-action btn-edit" (click)="editProduct(product)" title="Ch·ªânh s·ª≠a">
                ‚úèÔ∏è
              </button>
              <button class="btn-action btn-delete" (click)="deleteProduct(product)" title="X√≥a">
                üóëÔ∏è
              </button>
              <button class="btn-action btn-view" (click)="viewProduct(product)" title="Xem chi ti·∫øt">
                üëÅÔ∏è
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Load More Button -->
  <div class="load-more-container" *ngIf="currentPage < totalPages && !isLoading && !error && !showSkeleton">
    <button 
      class="btn btn-secondary load-more-btn" 
      (click)="loadMoreProducts()"
      [disabled]="isLoadingMore">
      <span *ngIf="!isLoadingMore">T·∫£i th√™m s·∫£n ph·∫©m</span>
      <span *ngIf="isLoadingMore">ƒêang t·∫£i...</span>
    </button>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="totalPages > 1">
    <div class="pagination">
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === 1"
        (click)="goToPage(currentPage - 1)">
        ‚Äπ
      </button>
      
      <button 
        *ngFor="let page of getPageNumbers()" 
        class="pagination-btn"
        [class.active]="page === currentPage"
        (click)="goToPage(page)">
        {{ page }}
      </button>
      
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === totalPages"
        (click)="goToPage(currentPage + 1)">
        ‚Ä∫
      </button>
    </div>
    
    <div class="pagination-info">
      Hi·ªÉn th·ªã {{ (currentPage - 1) * itemsPerPage + 1 }} - 
      {{ Math.min(currentPage * itemsPerPage, filteredProducts.length) }} 
      trong {{ filteredProducts.length }} s·∫£n ph·∫©m
    </div>
  </div>

  <!-- Add/Edit Product Modal -->
  <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditing ? 'Ch·ªânh s·ª≠a s·∫£n ph·∫©m' : 'Th√™m s·∫£n ph·∫©m m·ªõi' }}</h2>
        <button class="modal-close" (click)="closeModal()">√ó</button>
      </div>
      
      <form class="product-form" (ngSubmit)="saveProduct()" #productForm="ngForm">
        <div class="form-row">
          <div class="form-group">
            <label for="productName">T√™n s·∫£n ph·∫©m *</label>
            <input 
              type="text" 
              id="productName"
              [(ngModel)]="selectedProduct.name" 
              name="productName"
              required
              class="form-input">
          </div>
          <div class="form-group">
            <label for="productSku">SKU *</label>
            <input 
              type="text" 
              id="productSku"
              [(ngModel)]="selectedProduct.sku" 
              name="productSku"
              required
              class="form-input">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="productCategory">Danh m·ª•c *</label>
            <select 
              id="productCategory"
              [(ngModel)]="selectedProduct.category" 
              name="productCategory"
              required
              class="form-select">
              <option value="">Ch·ªçn danh m·ª•c</option>
              <option value="electronics">ƒêi·ªán t·ª≠</option>
              <option value="clothing">Th·ªùi trang</option>
              <option value="books">S√°ch</option>
              <option value="home">Gia d·ª•ng</option>
            </select>
          </div>
          <div class="form-group">
            <label for="productPrice">Gi√° (VND) *</label>
            <input 
              type="number" 
              id="productPrice"
              [(ngModel)]="selectedProduct.price" 
              name="productPrice"
              required
              min="0"
              class="form-input">
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="productStock">T·ªìn kho *</label>
            <input 
              type="number" 
              id="productStock"
              [(ngModel)]="selectedProduct.stock" 
              name="productStock"
              required
              min="0"
              class="form-input">
          </div>
          <div class="form-group">
            <label for="productStatus">Tr·∫°ng th√°i *</label>
            <select 
              id="productStatus"
              [(ngModel)]="selectedProduct.status" 
              name="productStatus"
              required
              class="form-select">
              <option value="active">Ho·∫°t ƒë·ªông</option>
              <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
              <option value="draft">B·∫£n nh√°p</option>
            </select>
          </div>
        </div>
        
        <div class="form-group">
          <label for="productImage">H√¨nh ·∫£nh s·∫£n ph·∫©m</label>
          
          <!-- Image Upload Area -->
          <div class="image-upload-area" (click)="triggerFileInput()" [class.has-image]="selectedProduct.imageUrl">
            <input 
              type="file" 
              id="productImage"
              accept="image/*"
              (change)="onFileSelected($event)"
              class="file-input"
              #fileInput>
            
            <!-- Upload Placeholder -->
            <div class="upload-placeholder" *ngIf="!selectedProduct.imageUrl">
              <div class="upload-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7,10 12,15 17,10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
              </div>
              <p class="upload-text">Click ƒë·ªÉ upload ·∫£nh</p>
            </div>
            
            <!-- Image Preview -->
            <div class="image-preview" *ngIf="selectedProduct.imageUrl">
              <img 
                [src]="selectedProduct.imageUrl" 
                [alt]="selectedProduct.name || 'Preview'"
                class="preview-image">
              <div class="image-overlay">
                <button type="button" class="remove-btn" (click)="removeImage($event)">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
                <button type="button" class="change-btn" (click)="triggerFileInput($event)">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7,10 12,15 17,10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                </button>
              </div>
            </div>
          </div>
          
          <!-- File Info -->
          <div class="file-info" *ngIf="selectedFile">
            <span class="file-name">{{ selectedFile.name }}</span>
            <span class="file-size">({{ formatFileSize(selectedFile.size) }})</span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="productDescription">M√¥ t·∫£</label>
          <textarea 
            id="productDescription"
            [(ngModel)]="selectedProduct.description" 
            name="productDescription"
            rows="4"
            class="form-textarea"></textarea>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="closeModal()">
            H·ªßy
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="!productForm.valid">
            {{ isEditing ? 'C·∫≠p nh·∫≠t' : 'Th√™m m·ªõi' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
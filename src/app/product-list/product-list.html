<div class="product-management">
  <!-- Back to Dashboard Button -->
  <div class="back-navigation">
    <button class="btn btn-secondary" (click)="goBack()">
      ‚Üê Quay l·∫°i Dashboard
    </button>
  </div>

  <!-- Header Section -->
  <div class="page-header floating">
    <div class="header-content">
      <h1 class="page-title">Qu·∫£n l√Ω s·∫£n ph·∫©m</h1>
      <p class="page-subtitle">Qu·∫£n l√Ω danh s√°ch s·∫£n ph·∫©m trong h·ªá th·ªëng</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="refreshProducts()" title="L√†m m·ªõi d·ªØ li·ªáu">
        <span class="btn-icon">üîÑ</span>
        L√†m m·ªõi
      </button>
        <button class="btn btn-primary glow" (click)="openAddProductModal()">
          <span class="btn-icon">+</span>
          Th√™m s·∫£n ph·∫©m
        </button>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section pulse">
    <div class="search-box">
      <input 
        type="text" 
        placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..." 
        [(ngModel)]="searchTerm"
        (input)="onSearchInput()"
        class="search-input">
      <span class="search-icon">üîç</span>
    </div>
    <div class="filter-controls">
            <select [(ngModel)]="selectedCategory" (change)="filterProducts()" class="filter-select">
              <option value="">T·∫•t c·∫£ danh m·ª•c</option>
              <option value="ƒêi·ªán t·ª≠">ƒêi·ªán t·ª≠</option>
              <option value="ƒêi·ªán gia d·ª•ng">ƒêi·ªán gia d·ª•ng</option>
              <option value="Th·ªùi trang">Th·ªùi trang</option>
              <option value="S√°ch">S√°ch</option>
              <option value="Gia d·ª•ng">Gia d·ª•ng</option>
            </select>
      <select [(ngModel)]="sortBy" (change)="sortProducts()" class="filter-select">
        <option value="name">S·∫Øp x·∫øp theo t√™n</option>
        <option value="price">S·∫Øp x·∫øp theo gi√°</option>
        <option value="stock">S·∫Øp x·∫øp theo t·ªìn kho</option>
        <option value="date">S·∫Øp x·∫øp theo ng√†y t·∫°o</option>
      </select>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-container" *ngIf="isLoading && !showSkeleton">
    <div class="loading-spinner"></div>
    <p>ƒêang t·∫£i danh s√°ch s·∫£n ph·∫©m...</p>
  </div>

  <!-- Skeleton Loading -->
  <div class="skeleton-container" *ngIf="showSkeleton">
    <div class="skeleton-table">
      <div class="skeleton-header">
        <div class="skeleton-cell" *ngFor="let i of [1,2,3,4,5,6,7]"></div>
      </div>
      <div class="skeleton-row" *ngFor="let i of [1,2,3,4,5,6,7,8,9,10]">
        <div class="skeleton-cell skeleton-image"></div>
        <div class="skeleton-cell skeleton-text"></div>
        <div class="skeleton-cell skeleton-badge"></div>
        <div class="skeleton-cell skeleton-price"></div>
        <div class="skeleton-cell skeleton-badge"></div>
        <div class="skeleton-cell skeleton-date"></div>
        <div class="skeleton-cell skeleton-actions"></div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-container" *ngIf="error && !isLoading">
    <div class="error-message">
      <span class="error-icon">‚ö†Ô∏è</span>
      <p>{{ error }}</p>
      <button class="btn btn-primary" (click)="loadProducts()">Th·ª≠ l·∫°i</button>
    </div>
  </div>

  <!-- Products Table -->
  <div class="table-container" *ngIf="!isLoading && !error && !showSkeleton">
    <table class="products-table">
      <thead>
        <tr>
          <th>H√¨nh ·∫£nh</th>
          <th>T√™n s·∫£n ph·∫©m</th>
          <th>Danh m·ª•c</th>
          <th>Gi√°</th>
          <th>Tr·∫°ng th√°i</th>
          <th>Ng√†y t·∫°o</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of filteredProducts; trackBy: trackByProductId">
          <td class="product-image">
            <img 
              [src]="getProductImage(product)" 
              [alt]="product.name" 
              class="product-thumbnail"
              loading="lazy"
              (error)="onImageError($event)">
          </td>
          <td class="product-name">
            <div class="name-cell">
              <span class="name">{{ product.name }}</span>
              <span class="sku">SKU: {{ product.sku }}</span>
            </div>
          </td>
          <td class="product-category">
            <span class="category-badge" [class]="'category-' + product.category">
              {{ getCategoryName(product.category) }}
            </span>
          </td>
          <td class="product-price">
            <span class="price">{{ formatCurrency(product.price) }}</span>
          </td>
          <td class="product-status">
            <span class="status-badge" [class.active]="product.status" [class.inactive]="!product.status">
              {{ getStatusText(product.status) }}
            </span>
          </td>
          <td class="product-date">
            {{ product.createdAt | date:'dd/MM/yyyy' }}
          </td>
          <td class="product-actions">
            <div class="action-buttons">
              <button class="btn-action btn-edit" (click)="editProduct(product)" title="Ch·ªânh s·ª≠a">
                ‚úèÔ∏è
              </button>
              <button class="btn-action btn-delete" (click)="deleteProduct(product)" title="X√≥a">
                üóëÔ∏è
              </button>
              <button class="btn-action btn-view" (click)="viewProduct(product)" title="Xem chi ti·∫øt">
                üëÅÔ∏è
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Load More Button -->
  <div class="load-more-container" *ngIf="currentPage < totalPages && !isLoading && !error && !showSkeleton">
    <button 
      class="btn btn-secondary load-more-btn" 
      (click)="loadMoreProducts()"
      [disabled]="isLoadingMore">
      <span *ngIf="!isLoadingMore">T·∫£i th√™m s·∫£n ph·∫©m</span>
      <span *ngIf="isLoadingMore">ƒêang t·∫£i...</span>
    </button>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="totalPages > 1">
    <div class="pagination">
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === 1"
        (click)="goToPage(currentPage - 1)">
        ‚Äπ
      </button>
      
      <button 
        *ngFor="let page of getPageNumbers()" 
        class="pagination-btn"
        [class.active]="page === currentPage"
        (click)="goToPage(page)">
        {{ page }}
      </button>
      
      <button 
        class="pagination-btn" 
        [disabled]="currentPage === totalPages"
        (click)="goToPage(currentPage + 1)">
        ‚Ä∫
      </button>
    </div>
    
    <div class="pagination-info">
      Hi·ªÉn th·ªã {{ (currentPage - 1) * itemsPerPage + 1 }} - 
      {{ Math.min(currentPage * itemsPerPage, filteredProducts.length) }} 
      trong {{ filteredProducts.length }} s·∫£n ph·∫©m
    </div>
  </div>

  <!-- Add/Edit Product Modal -->
  <app-product-insert-edit 
    [showModal]="showModal"
    [isEditing]="isEditing"
    [selectedProduct]="selectedProduct"
    (modalClosed)="closeModal()"
    (productSaved)="onProductSaved($event)">
  </app-product-insert-edit>
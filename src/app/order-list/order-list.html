<div class="w-full py-8 md:py-12">
  <!-- Main Card Container -->
  <div class="product-list-container overflow-hidden rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
    <!-- Card Header -->
    <div class="product-list-header">
      <div class="header-content">
        <div class="header-text">
          <h3>Qu·∫£n l√Ω ƒë∆°n h√†ng</h3>
          <p>Theo d√µi v√† x·ª≠ l√Ω ƒë∆°n h√†ng c·ªßa kh√°ch h√†ng.</p>
        </div>
        <div class="header-actions">
          <button 
            class="action-button secondary"
            (click)="loadOrders()" 
            [disabled]="loading"
            title="L√†m m·ªõi d·ªØ li·ªáu">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            <span>L√†m m·ªõi</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Search and Filter Bar -->
    <div class="search-filter-wrapper">
      <div class="search-filter-content">
        <div class="search-input-wrapper">
          <div class="relative group">
            <input 
              type="text" 
              placeholder="T√¨m theo m√£ ƒë∆°n h√†ng, t√™n kh√°ch h√†ng..." 
              [(ngModel)]="searchTerm"
              (input)="onSearchInput($event)"
              (keyup.enter)="onSearch()"
              class="search-input">
            <span class="search-icon">
              <svg class="w-5 h-5" viewBox="0 0 20 20" fill="none">
                <path fill-rule="evenodd" clip-rule="evenodd"
                  d="M3.04175 9.37363C3.04175 5.87693 5.87711 3.04199 9.37508 3.04199C12.8731 3.04199 15.7084 5.87693 15.7084 9.37363C15.7084 12.8703 12.8731 15.7053 9.37508 15.7053C5.87711 15.7053 3.04175 12.8703 3.04175 9.37363ZM9.37508 1.54199C5.04902 1.54199 1.54175 5.04817 1.54175 9.37363C1.54175 13.6991 5.04902 17.2053 9.37508 17.2053C11.2674 17.2053 13.003 16.5344 14.357 15.4176L17.177 18.238C17.4699 18.5309 17.9448 18.5309 18.2377 18.238C18.5306 17.9451 18.5306 17.4703 18.2377 17.1774L15.418 14.3573C16.5365 13.0033 17.2084 11.2669 17.2084 9.37363C17.2084 5.04817 13.7011 1.54199 9.37508 1.54199Z"
                  fill="currentColor" />
              </svg>
            </span>
          </div>
        </div>
        <div class="filter-actions">
          <select 
            [(ngModel)]="selectedStatus" 
            (change)="onStatusChange(selectedStatus)"
            class="status-select">
            <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
            <option value="pending">Ch·ªù x·ª≠ l√Ω</option>
            <option value="paid">ƒê√£ thanh to√°n</option>
            <option value="shipped">ƒêang giao</option>
            <option value="delivered">ƒê√£ giao</option>
            <option value="cancelled">ƒê√£ h·ªßy</option>
          </select>
          <button 
            class="action-button secondary clear-filter-button"
            (click)="clearSearch()" 
            title="X√≥a b·ªô l·ªçc">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
            <span>X√≥a b·ªô l·ªçc</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div class="flex flex-col items-center justify-center py-12" *ngIf="loading && !showSkeleton">
      <div class="w-10 h-10 border-4 border-gray-200 border-t-brand-500 rounded-full animate-spin mb-4"></div>
      <p class="text-gray-500 dark:text-gray-400">ƒêang t·∫£i ƒë∆°n h√†ng...</p>
    </div>

    <!-- Error State -->
    <div class="flex flex-col items-center justify-center py-12 text-center" *ngIf="error && !loading">
      <div class="text-4xl mb-4">‚ö†Ô∏è</div>
      <p class="text-gray-700 dark:text-gray-300 mb-4">{{ error }}</p>
      <button 
        class="inline-flex items-center gap-2 rounded-lg bg-brand-500 px-4 py-2.5 text-theme-sm font-medium text-white shadow-theme-xs hover:bg-brand-600"
        (click)="loadOrders()">
        Th·ª≠ l·∫°i
      </button>
    </div>

    <!-- Orders Table -->
    <div class="product-table-wrapper" *ngIf="!loading && !error && !showSkeleton && orders.length > 0">
      <table class="orders-table">
        <thead>
          <tr>
            <th>M√£ ƒë∆°n h√†ng</th>
            <th>Kh√°ch h√†ng</th>
            <th>T·ªïng ti·ªÅn</th>
            <th>Ph√≠ ship</th>
            <th>Gi·∫£m gi√°</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Ng√†y ƒë·∫∑t</th>
            <th class="text-center">Thao t√°c</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let order of orders; trackBy: trackByOrderId" class="order-row">
            <td>
              <span class="order-number">{{ order.orderNumber }}</span>
            </td>
            <td>
              <div class="customer-info">
                <div class="customer-name">{{ order.customerName }}</div>
                <div class="customer-id">ID: {{ order.customerId }}</div>
              </div>
            </td>
            <td>
              <span class="total-amount">{{ getFormattedOrder(order.id)?.formattedTotalAmount }}</span>
            </td>
            <td>
              <span class="shipping-fee">{{ getFormattedOrder(order.id)?.formattedShippingFee }}</span>
            </td>
            <td>
              <span *ngIf="order.discountAmount > 0" class="discount-amount">
                -{{ getFormattedOrder(order.id)?.formattedDiscountAmount }}
              </span>
              <span *ngIf="order.discountAmount === 0" class="no-discount">
                Kh√¥ng
              </span>
            </td>
            <td>
              <app-badge size="sm" [color]="getFormattedOrder(order.id)?.statusColor || 'light'">
                {{ getFormattedOrder(order.id)?.statusText }}
              </app-badge>
            </td>
            <td>
              <span class="order-date">{{ getFormattedOrder(order.id)?.formattedDate }}</span>
            </td>
            <td class="actions-cell">
              <button 
                class="view-details-button"
                (click)="viewOrderDetails(order)" 
                title="Xem chi ti·∫øt">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                </svg>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div class="flex flex-col items-center justify-center py-12 text-center" *ngIf="!loading && !error && !showSkeleton && orders.length === 0">
      <div class="text-4xl mb-4">üì¶</div>
      <p class="text-gray-500 dark:text-gray-400">Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o</p>
      <p class="text-sm text-gray-400 dark:text-gray-500 mt-1">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o ƒë∆∞·ª£c t√¨m th·∫•y v·ªõi b·ªô l·ªçc hi·ªán t·∫°i.</p>
    </div>

    <!-- Pagination -->
    <div class="pagination-wrapper" *ngIf="!loading && !error && !showSkeleton && orders.length > 0">
      <div class="pagination">
        <button 
          class="pagination-button"
          [disabled]="currentPage === 1"
          (click)="onPageChange(currentPage - 1)">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
          <span>Tr∆∞·ªõc</span>
        </button>
        <span class="page-info">
          Trang {{ currentPage }}
        </span>
        <button 
          class="pagination-button"
          (click)="onPageChange(currentPage + 1)">
          <span>Sau</span>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Order Details Modal -->
  <div 
    *ngIf="showOrderDetailsModal" 
    class="modal-overlay" 
    (click)="closeOrderDetailsModal()" 
    (keydown.escape)="closeOrderDetailsModal()" 
    tabindex="0" 
    role="dialog" 
    aria-modal="true">
    <div 
      class="modal-content order-details-modal" 
      (click)="$event.stopPropagation()" 
      tabindex="-1" 
      role="document">
      <div class="modal-header">
        <h2>Chi ti·∫øt ƒë∆°n h√†ng {{ selectedOrder?.orderNumber }}</h2>
        <button 
          class="modal-close" 
          (click)="closeOrderDetailsModal()" 
          type="button" 
          aria-label="ƒê√≥ng modal">
          √ó
        </button>
      </div>

      <div class="modal-body">
        <!-- Order Info -->
        <div *ngIf="selectedOrder" class="order-info-section">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="info-item">
              <p class="info-label">Kh√°ch h√†ng</p>
              <p class="info-value">{{ selectedOrder.customerName }}</p>
            </div>
            <div class="info-item">
              <p class="info-label">Tr·∫°ng th√°i</p>
              <div class="info-value">
                <app-badge size="sm" [color]="getStatusColor(selectedOrder.status)">
                  {{ getStatusText(selectedOrder.status) }}
                </app-badge>
              </div>
            </div>
            <div class="info-item">
              <p class="info-label">S·ªë ƒëi·ªán tho·∫°i</p>
              <p class="info-value">
                {{ selectedOrder.phone || 'Ch∆∞a c√≥ th√¥ng tin' }}
              </p>
            </div>
            <div class="info-item">
              <p class="info-label">Ng√†y ƒë·∫∑t</p>
              <p class="info-value">{{ formatDate(selectedOrder.placedAt) }}</p>
            </div>
            <div class="info-item col-span-1 md:col-span-2">
              <p class="info-label">ƒê·ªãa ch·ªâ giao h√†ng</p>
              <p class="info-value address-text">
                {{ selectedOrder.address || 'Ch∆∞a c√≥ th√¥ng tin' }}
              </p>
            </div>
            <div class="info-item col-span-1 md:col-span-2 total-amount-section">
              <p class="info-label">T·ªïng ti·ªÅn</p>
              <p class="total-amount">{{ formatCurrency(selectedOrder.totalAmount) }}</p>
            </div>
          </div>
        </div>

        <!-- Order Details List -->
        <div class="order-details-list">
          <h3 class="section-title">Danh s√°ch s·∫£n ph·∫©m</h3>
          
          <!-- Loading State for Order Details -->
          <div *ngIf="loadingDetails && orderDetails.length === 0 && !detailsError" class="loading-state">
            <div class="spinner"></div>
            <p class="loading-text">ƒêang t·∫£i danh s√°ch s·∫£n ph·∫©m...</p>
          </div>

          <!-- Error State -->
          <div *ngIf="detailsError" class="error-state">
            <div class="error-icon">‚ö†Ô∏è</div>
            <p class="error-text">{{ detailsError }}</p>
            <button 
              class="retry-button"
              (click)="viewOrderDetails(selectedOrder!)">
              Th·ª≠ l·∫°i
            </button>
          </div>

          <!-- Order Details Items -->
          <div *ngIf="!detailsError && orderDetails.length > 0" class="products-list">
            <div 
              *ngFor="let item of orderDetails; trackBy: trackByOrderDetailId" 
              class="product-item">
              <div class="product-content">
                <!-- Product Image -->
                <div class="product-image-wrapper">
                  <img 
                    [src]="getProductImage(item.product.imageUrl, item.product.name, item.product.productGroup)" 
                    [alt]="item.product.name || 'S·∫£n ph·∫©m'"
                    class="product-image"
                    (error)="onImageError($event, item.product.name, item.product.productGroup)">
                </div>
                
                <!-- Product Info -->
                <div class="product-info">
                  <h4 class="product-name">
                    {{ item.product.name || 'S·∫£n ph·∫©m kh√¥ng x√°c ƒë·ªãnh' }}
                  </h4>
                  <p class="product-code">
                    M√£: {{ item.product.productCode || 'N/A' }}
                  </p>
                  <div class="product-details">
                    <span class="detail-item">
                      <span class="detail-label">S·ªë l∆∞·ª£ng:</span>
                      <span class="detail-value">{{ item.quantity }}</span>
                    </span>
                    <span class="detail-item">
                      <span class="detail-label">ƒê∆°n gi√°:</span>
                      <span class="detail-value">{{ formatCurrency(item.price) }}</span>
                    </span>
                    <span class="detail-item total-price">
                      <span class="detail-label">Th√†nh ti·ªÅn:</span>
                      <span class="detail-value">{{ formatCurrency(item.price * item.quantity) }}</span>
                    </span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Order Summary -->
          <div *ngIf="!detailsError && orderDetails.length > 0" class="order-summary">
            <div class="summary-row">
              <span class="summary-label">T·ªïng ti·ªÅn s·∫£n ph·∫©m:</span>
              <span class="summary-value">
                {{ formatCurrency(getTotalProductAmount()) }}
              </span>
            </div>
            <div class="summary-row" *ngIf="selectedOrder?.shippingFee">
              <span class="summary-label">Ph√≠ ship:</span>
              <span class="summary-value">
                {{ formatCurrency(selectedOrder?.shippingFee || 0) }}
              </span>
            </div>
            <div class="summary-row" *ngIf="selectedOrder?.discountAmount">
              <span class="summary-label">Gi·∫£m gi√°:</span>
              <span class="summary-value discount">
                -{{ formatCurrency(selectedOrder?.discountAmount || 0) }}
              </span>
            </div>
            <div class="summary-row total-row">
              <span class="summary-label total-label">T·ªïng c·ªông:</span>
              <span class="summary-value total-value">
                {{ formatCurrency(selectedOrder?.totalAmount || 0) }}
              </span>
            </div>
          </div>
        </div>

        <!-- Empty State (only show if API returned empty, not while loading) -->
        <div *ngIf="detailsError === null && orderDetails.length === 0 && !loadingDetails" class="flex flex-col items-center justify-center py-8 text-center">
          <div class="text-4xl mb-3">üì¶</div>
          <p class="text-sm text-gray-500 dark:text-gray-400">Kh√¥ng c√≥ chi ti·∫øt ƒë∆°n h√†ng</p>
        </div>
      </div>

      <div class="modal-footer">
        <button 
          class="modal-close-button"
          (click)="closeOrderDetailsModal()"
          type="button">
          ƒê√≥ng
        </button>
      </div>
    </div>
  </div>
</div>
